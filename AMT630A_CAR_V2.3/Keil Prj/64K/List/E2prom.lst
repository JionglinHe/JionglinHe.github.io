C51 COMPILER V9.51   E2PROM                                                                09/08/2019 13:51:41 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE E2PROM
OBJECT MODULE PLACED IN ..\Hex\E2prom.obj
COMPILER INVOKED BY: E:\keil5\Keil\C51\BIN\C51.EXE ..\..\..\Device driver\E2prom\E2prom.c OPTIMIZE(8,SPEED) BROWSE INCDI
                    -R(..\..\..\OSD;..\..\..\OSD\Logo;../../../Inc;../../../UserConfig;../../../ARKLib;../../../UserConfig/Prj config;..\..\.
                    -.\LCD Pannels;..\..\..\LCD Pannels\LCD parameter;..\..\..\GetUserInput;..\..\..\GetUserInput\Ir;..\..\..\GetUserInput\Ke
                    -y;..\..\..\GetUserInput\GPIO;..\..\..\Device driver\AMT;..\..\..\Device driver\ArkChip;..\..\..\Device driver\Mcu;..\..\
                    -..\Device driver\Flash;..\..\..\Device driver\I2C;..\..\..\Device driver\E2prom;..\..\..\Device driver\WT5700;..\..\..\D
                    -evice driver\Kt0803l;..\..\..\Device driver\BT;..\..\..\Debug) DEBUG OBJECTEXTEND PRINT(..\List\E2prom.lst) OBJECT(..\He
                    -x\E2prom.obj)

line level    source

   1          /****************************************************************************************************
   2          *Copyright (C) 2005 深圳艾科创新有限公司产品应用一部
   3          * All rights reserved.
   4          
   5          *File name: 　 drv_E2prom.c
   6          *Version:    　0.01
   7          *Author:       cjinzong
   8          *Finish date:  2009-04-16
   9          
  10          *Description:
  11          *           这个文件是对系统的主要参数进行保存到E2PROM的函数定义。 
  12          
  13          *History:
  14          *
  15          ***************************************************************************************************/
  16          #define _E2P_C_
  17          #include "DataType.h"
  18          #include "systemConfig.h"
  19          #include "global.h"
*** WARNING C245 IN LINE 12 OF E:\keil5\Keil\C51\Inc\intrins.h: unknown #pragma, line ignored
*** ERROR C263 IN LINE 36 OF E:\keil5\Keil\C51\Inc\intrins.h: save/restore: stack overflow/underflow
  20          #include "E2prom.h"
  21          #include "debug.h"
  22          #include "AMT_REG.h"
  23          #include "AMT_Drv.h"
  24          #include "AMT_MCU.h"
  25          
  26          
  27          
  28          #ifdef E2promEn
              
              /***********************************************************
              *name:      E2promReadMultiple(UCHAR page, UCHAR subAddr, UCHAR rdNum, UCHAR * dataPt)
              *input:     UCHAR page
                          UCHAR subAddr 
                          UCHAR rdNum
                          UCHAR * dataPt
                               
              *output:    dataPt
              *return:     non    
              
              *description:   在e2prom中读出多个字节的数据 
              *history:
              ************************************************************/
              void ReadE2promMultiple(ULONG subAddr, UCHAR * dataPt, UINT rdNum)
              {
                UINT XDATA i=0;
              
              start:
C51 COMPILER V9.51   E2PROM                                                                09/08/2019 13:51:41 PAGE 2   

              
                #if 1
                E2pI2CStart(); 
                E2pI2CWrite(0xa0);
              #if 1
                      if(E2pACKCheck() == 1)
                      {
                          goto start;
                      }
              #endif
               
                E2pI2CWrite((subAddr>>8)&0xff);
                E2pACKCheck();
                E2pI2CWrite(subAddr&0xff);
                E2pACKCheck();
              
                E2pI2CStart(); 
                E2pI2CWrite(0xa1);
                E2pACKCheck();
               
                for(i=0; i<rdNum; i++)
                {
                  dataPt[i] = E2pI2CRead(); 
                  E2pACKSend();       
                }
                dataPt[i] = E2pI2CRead(); 
                E2pNACKSend();  
                E2pI2CStop();
                #endif
              
              }
              /***********************************************************
              *name:    E2WriteByte(WORD address,BYTE WrData)
              *input:            
              *output:    non
              *return:     tmpResult
              *description:   对e2prom 写入多个数据
              *history:
              ************************************************************/
              void WriteE2promMultByte(ULONG address, UCHAR * dataPt, WORD number)
              {        
                      UINT XDATA pos = 0;
              
                      while(number>0)
                      {
                          UCHAR j;
                              
              start:          
                          E2pI2CStart();
                          E2pI2CWrite(0xa0); 
                              #if 1
                              if(E2pACKCheck() == 1)
                              { 
                                  goto start;
                              }
                              #endif
                              
                              E2pI2CWrite((UCHAR)((address>>8)&0xff));
                              E2pACKCheck();
              
                              E2pI2CWrite((UCHAR)(address&0xff));
                              E2pACKCheck();
C51 COMPILER V9.51   E2PROM                                                                09/08/2019 13:51:41 PAGE 3   

              
                              if(number >= 32)
                              {
                                      for(j=0;j<32;j++,pos++)
                                      {
                                              E2pI2CWrite(dataPt[pos]);
                                      E2pACKCheck(); 
                                              number--;
                                      }
                                  E2pI2CStop();       
                                      address =  address + 32;
                              }
                              else
                              {
                                  for(;number>0;number--)
                                  {
              start1:
                                              E2pI2CStart();
                                              E2pI2CWrite(0xa0); 
              #if 1
                                              if(E2pACKCheck() == 1)
                                              { 
                                              goto start1;
                                              }
              #endif
                                              E2pI2CWrite((UCHAR)((address>>8)&0xff));
                                              E2pACKCheck();
              
                                              E2pI2CWrite((UCHAR)(address&0xff));
                                              E2pACKCheck();
                                              
                                              E2pI2CWrite(dataPt[pos]);
                                              E2pACKCheck(); 
                                          E2pI2CStop();
                                              
                                              address++;
                                              pos++;  
                                  }
                              }
                      }
              }
              
              
              BOOL VerifyE2promDate(ULONG stAddr)
              {
                  UCHAR XDATA i;
                      
                  for(i=0;i<3;i++)
                  {
                              ReadE2promMultiple(stAddr, (UCHAR *)&g_sysSetting, sizeof(SysWorkParaType)); 
                              if((g_sysSetting.OXAA == 0xaa) && (g_sysSetting.OX55 == 0x55))
                              {
                                   return TRUE;
                              }
                  }
                      return FALSE;
              }
              #endif
 168          

C51 COMPILATION COMPLETE.  1 WARNING(S),  1 ERROR(S)
