C51 COMPILER V9.51   E2PI2C                                                                09/08/2019 13:51:41 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE E2PI2C
OBJECT MODULE PLACED IN ..\Hex\E2pI2C.obj
COMPILER INVOKED BY: E:\keil5\Keil\C51\BIN\C51.EXE ..\..\..\Device driver\I2C\E2pI2C.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.
                    -.\..\..\OSD;..\..\..\OSD\Logo;../../../Inc;../../../UserConfig;../../../ARKLib;../../../UserConfig/Prj config;..\..\..\L
                    -CD Pannels;..\..\..\LCD Pannels\LCD parameter;..\..\..\GetUserInput;..\..\..\GetUserInput\Ir;..\..\..\GetUserInput\Key;.
                    -.\..\..\GetUserInput\GPIO;..\..\..\Device driver\AMT;..\..\..\Device driver\ArkChip;..\..\..\Device driver\Mcu;..\..\..\
                    -Device driver\Flash;..\..\..\Device driver\I2C;..\..\..\Device driver\E2prom;..\..\..\Device driver\WT5700;..\..\..\Devi
                    -ce driver\Kt0803l;..\..\..\Device driver\BT;..\..\..\Debug) DEBUG OBJECTEXTEND PRINT(..\List\E2pI2C.lst) OBJECT(..\Hex\E
                    -2pI2C.obj)

line level    source

   1          /**************************************************************
   2          *Copyright (C) 2005 深圳艾科创新有限公司产品应用一部
   3          * All rights reserved.
   4          
   5          *File name: 　 E2pI2C.C   
   6          *Version:    　0.01
   7          *Author:       cjinzong
   8          *Update:       2009-03-25
   9          *State：       try out
  10          * 
  11          *Description:
  12          *    这个文件是用来定义i2c 的一些基本的操作。
  13          
  14          *History:
  15          *
  16          ****************************************************************/
  17          
  18          #include "DataType.h"
  19          #include "systemConfig.h"
  20          #include "global.h"
*** WARNING C245 IN LINE 12 OF E:\keil5\Keil\C51\Inc\intrins.h: unknown #pragma, line ignored
*** ERROR C263 IN LINE 36 OF E:\keil5\Keil\C51\Inc\intrins.h: save/restore: stack overflow/underflow
  21          #include "AMT_Drv.h"
  22          
  23          
  24          #ifdef E2promEn
              
              #define SetSdaOutput() ;  
              #define SetSdaInput()  GetSda()
              #define SetSclOutput() ;
              
              #define GetSda()   hw_E2p_getSDA_input()
              #define SetSda(x)  hw_E2p_setSDA_output(x)
              #define SetScl(x)  hw_E2p_setSCL_output(x)
                                                       
              /***********************************************************
              *name:    DelayE2pI2c()
              *input:   uchar delayTime   // 确定延时时间
              *output:  non
              *update:  2009-03-25
              
              *description:   iic 延时程序
              *history:
              ************************************************************/
              void DelayE2pI2c(UINT delayTime)        
              {
                      while(delayTime) 
                      {
                          delayTime = delayTime - 1;
C51 COMPILER V9.51   E2PI2C                                                                09/08/2019 13:51:41 PAGE 2   

                  }   
              } 
              /**********************************************************
              *name:    I2CStart(void)
              *input:   non
              *output:  发送START
              *update:  2009-03-25
              
              *description:   iic的start信号函数,表示将要开始进行数据传输
                        start : 14*1.085=15.9u
              
              *history:
              ***********************************************************/
              void E2pI2CStart(void)
              {  
                      SetSdaOutput();
                  SetSclOutput();
              
                      DelayE2pI2c(5);
                                                              //___
                      SetSda(1);                      //       |
                      SetScl(1);                      //       |___SDA
                      DelayE2pI2c(10);                //____  
                      SetSda(0);                      //        |
                      DelayE2pI2c(10);                //        |__SCL
                      SetScl(0);      
                      DelayE2pI2c(10);
              
              }
              /***********************************************************
              *name:    I2CStop(void)
              *input:   non
              *output:  发送STOP
              *update:  2009-03-25
              
              *description:   iic的stop 信号函数，说明数据传输完毕
              
                          stop : 13*1.085 = 14.1u
              *history:
              ************************************************************/
              void E2pI2CStop(void)
              {   
                  SetSdaOutput();
                                    //    ___SDA
                      SetSda(0);                //   |
                      SetScl(1);                        //___|
                      DelayE2pI2c(5);   //_______SCL
                      SetSda(1);                //
                      DelayE2pI2c(5);   //
              
              }
              /***********************************************************
              *name:    ACKCheck(void)
              *input:   non
              *output:  bit      //FLAG 就是bit   在general.h 文件中定义
              *update:  2009-03-25
              
              *description:   iic的ack 信号检测函数  
                              ACKCheck = 14u
              *history:
              ************************************************************/
              FLAG E2pACKCheck(void)
C51 COMPILER V9.51   E2PI2C                                                                09/08/2019 13:51:41 PAGE 3   

              {
                  UCHAR loop = 200;
                      
                  SetSdaInput();
                      
                      DelayE2pI2c(2);                                                            
                      SetScl(1);
                      do
                      {
                          DelayE2pI2c(2);
                              if(GetSda() == 0)
                              {
                                 SetScl(0);                                                                      
                             return(0);    //这里说明有ACK信号  
                              }
                              else
                              {
                                 if(loop == 1)
                                 {
                                      SetScl(0);                                                                         
                                  return(1);   
                                 }
                              }
                      }while(--loop) ;
                  return 1;   
              }
              /***********************************************************
              *name:   ACKSend(void)
              *input:  non
              *output: ACK 发送
              *update: 2009-03-25
              
              *description:   iic的ack 信号发送函数
              *history:
              ************************************************************/
              void E2pACKSend(void)
              {
                  SetSdaOutput();
                      
                      SetSda(0);            //"发送应答位"
                      DelayE2pI2c(1);
                      SetScl(1);      
                      DelayE2pI2c(1);
                      SetScl(0);      
                      DelayE2pI2c(1);
                      SetSda(1);      
              }
              
              /***********************************************************
              *name:N ACKSend(void)
              *input:  non
              *output: NACK send
              *update: 2009-03-25
              
              *description:   iic的nack 信号发送函数
              *history:
              ************************************************************/
              void E2pNACKSend(void)
              {
                  SetSdaOutput();
                      
                      SetSda(1);           //"发送非应答位"
C51 COMPILER V9.51   E2PI2C                                                                09/08/2019 13:51:41 PAGE 4   

                      DelayE2pI2c(2);
                      SetScl(1);      
                      DelayE2pI2c(2);
                      SetScl(0);      
                      DelayE2pI2c(2);
                      SetSda(1);      
              }
              
              
              /***********************************************************
              *name:    I2CWrite(UCHAR tempdata)
              *input:   UCHAR tempdata
              *output:  对相应的空间写一个字节数据
              *update:  2009-03-25
              
              *description:   iic的write一个字节函数 
                              100u
              *history:
              ************************************************************/
              void E2pI2CWrite(UCHAR tempdata)
              {
                      UCHAR XDATA num;                           //"发送数据位数"
                      
                      SetSdaOutput();
                      
                      for(num = 0;num < 8;num ++)
                      {
                              SetSda((tempdata >> (7-num)) & 1);      //"先发高位"
                              DelayE2pI2c(2);
                              SetScl(1);                        //下降缘 读取
                              DelayE2pI2c(2);
                              SetScl(0);
                              DelayE2pI2c(2); 
                      }
                      SetSda(1);
              }
              
              
              /***********************************************************
              *name:    I2CRead(void)
              *input:   non
              *output:  返回读出的字节
              *update:  2009-03-25
              
              *description:   iic的read一个字节 数据函数
              *history:
              ************************************************************/
              UCHAR E2pI2CRead(void)
              {
              
                      UCHAR XDATA temp = 0xff;
                      UCHAR XDATA num;         //"接收数据位数"
              
                      SetSdaInput();
              
                      for(num = 0;num < 8;num ++)
                      {
                        
                              SetScl(1);
                              DelayE2pI2c(2);
                              temp = temp << 1;//"先接收高位"
              
C51 COMPILER V9.51   E2PI2C                                                                09/08/2019 13:51:41 PAGE 5   

                              if(GetSda() == 1)
                              {
                                      temp = temp | 0x01;
                              }
              
                              if(GetSda() == 0)
                              {
                                      temp = temp & 0xfe;
                              }
              
                              SetScl(0);
                              DelayE2pI2c(2);
                      }
              
                      return (temp);
              }
              #endif
 251          
 252          
 253          

C51 COMPILATION COMPLETE.  1 WARNING(S),  1 ERROR(S)
